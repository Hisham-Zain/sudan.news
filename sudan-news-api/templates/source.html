<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ source.outlet_name or source.name }} - تفاصيل المصدر</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background-color: white;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: center;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .app-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
        }

        .hamburger {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            color: #007bff;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .back-link:hover {
            background-color: #f8f9fa;
            text-decoration: none;
            color: #0056b3;
        }

        /* Professional Header Section */
        .source-hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .source-hero::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(50%, -50%);
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .source-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0 0 10px 0;
            line-height: 1.2;
        }

        .source-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .hero-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 25px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .meta-item i {
            opacity: 0.8;
        }

        .hero-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .action-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-primary:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Information Cards Grid */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
            color: #333;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 500;
            color: #666;
            font-size: 0.9rem;
        }

        .info-value {
            font-weight: 600;
            color: #333;
            text-align: right;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .badge-high {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .badge-medium {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .badge-low {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .bias-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bias-pro {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .bias-neutral {
            background: linear-gradient(135deg, #6c757d, #545b62);
            color: white;
        }

        .bias-oppose {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        /* Recent Articles Section */
        .recent-articles {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        .articles-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }

        .articles-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0;
            color: #333;
        }

        .articles-count {
            background: #e9ecef;
            color: #495057;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .article-item {
            padding: 15px 0;
            border-bottom: 1px solid #f8f9fa;
            transition: background-color 0.2s;
        }

        .article-item:hover {
            background-color: #f8f9fa;
        }

        .article-item:last-child {
            border-bottom: none;
        }

        .article-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 1rem;
            line-height: 1.4;
        }

        .article-meta {
            font-size: 0.85rem;
            color: #666;
            display: flex;
            gap: 15px;
        }

        /* Methodology Section */
        .methodology-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .methodology-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }

        .methodology-header:hover {
            background: linear-gradient(135deg, #218838, #1aa085);
        }

        .methodology-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }

        .toggle-icon {
            font-size: 1.2rem;
            transition: transform 0.2s;
        }

        .methodology-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .methodology-content.expanded {
            max-height: 1000px;
        }

        .methodology-intro {
            padding: 25px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            font-size: 1rem;
            line-height: 1.6;
            color: #555;
        }

        .bias-categories {
            padding: 25px;
        }

        .bias-category {
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .bias-category-header {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            font-weight: 600;
        }

        .bias-category-header.pro {
            background: linear-gradient(135deg, #007bff, #0056b3);
        }

        .bias-category-header.oppose {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .bias-category-header.neutral {
            background: linear-gradient(135deg, #6c757d, #545b62);
        }

        .bias-description {
            padding: 20px;
            background: white;
            line-height: 1.6;
            color: #555;
        }

        .no-data {
            text-align: center;
            color: #888;
            padding: 60px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .no-data i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .source-hero {
                padding: 25px;
            }

            .source-title {
                font-size: 2rem;
            }

            .hero-meta {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .hero-actions {
                flex-direction: column;
                width: 100%;
            }

            .action-btn {
                justify-content: center;
                flex: 1;
            }

            .info-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .info-card {
                padding: 20px;
            }

            .recent-articles {
                padding: 20px;
            }

            .methodology-intro {
                padding: 20px;
                font-size: 0.95rem;
            }

            .bias-categories {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .source-title {
                font-size: 1.8rem;
            }

            .hero-meta {
                font-size: 0.9rem;
            }

            .card-title {
                font-size: 1.1rem;
            }

            .info-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .info-value {
                text-align: left;
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-actions">
            <a href="{{ url_for('index') }}">
                <img src="{{ url_for('static', filename='img/logo_animate.svg') }}" alt="App Icon" class="app-icon">
            </a>
            <button class="hamburger">☰</button>
        </div>
        <div class="logo">أخبار السودان</div>
    </header>

    <div class="container">
        <a href="{{ url_for('index') }}" class="back-link">
            <i class="fas fa-arrow-right"></i>
            العودة إلى الرئيسية
        </a>

        {% if source %}
        <!-- Professional Hero Section -->
        <div class="source-hero">
            <div class="hero-content">
                <h1 class="source-title">{{ source.outlet_name or source.name }}</h1>
                {% if source.verification_status %}
                <p class="source-subtitle">{{ source.verification_status }}</p>
                {% endif %}

                <div class="hero-meta">
                    {% if source.bias %}
                    <div class="meta-item">
                        <i class="fas fa-balance-scale"></i>
                        <span class="bias-badge bias-{{ 'oppose' if source.bias == 'Oppose-SAF' else 'neutral' if source.bias == 'Neutral' else 'pro' if source.bias == 'Pro-SAF' else 'unknown' }}">
                            {{ source.bias | bias_arabic }}
                        </span>
                    </div>
                    {% endif %}

                    {% if source.founded_at %}
                    <div class="meta-item">
                        <i class="fas fa-calendar-alt"></i>
                        تأسس {{ source.founded_at }}
                    </div>
                    {% endif %}

                    {% if source.hq_location %}
                    <div class="meta-item">
                        <i class="fas fa-map-marker-alt"></i>
                        {{ source.hq_location }}
                    </div>
                    {% endif %}

                    {% if source.language %}
                    <div class="meta-item">
                        <i class="fas fa-language"></i>
                        {{ 'عربي' if source.language == 'ar' else source.language }}
                    </div>
                    {% endif %}
                </div>

                <div class="hero-actions">
                    <a href="{{ source.url }}" target="_blank" rel="noopener noreferrer" class="action-btn btn-primary">
                        <i class="fas fa-external-link-alt"></i>
                        زيارة الموقع
                    </a>
                    <button class="action-btn btn-secondary" onclick="toggleMethodology()">
                        <i class="fas fa-info-circle"></i>
                        منهجية التصنيف
                    </button>
                </div>
            </div>
        </div>

        <!-- Information Cards Grid -->
        <div class="info-grid">
            <!-- Basic Information Card -->
            <div class="info-card">
                <div class="card-header">
                    <div class="card-icon" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                        <i class="fas fa-building"></i>
                    </div>
                    <h3 class="card-title">معلومات أساسية</h3>
                </div>

                <div class="info-item">
                    <span class="info-label">الاسم الكامل</span>
                    <span class="info-value">{{ source.outlet_name or source.name }}</span>
                </div>

                {% if source.founded_year %}
                <div class="info-item">
                    <span class="info-label">سنة التأسيس</span>
                    <span class="info-value">{{ source.founded_year }}</span>
                </div>
                {% endif %}

                {% if source.headquarters_city and source.headquarters_country %}
                <div class="info-item">
                    <span class="info-label">المقر الرئيسي</span>
                    <span class="info-value">{{ source.headquarters_city }}, {{ source.headquarters_country }}</span>
                </div>
                {% elif source.hq_location %}
                <div class="info-item">
                    <span class="info-label">المقر الرئيسي</span>
                    <span class="info-value">{{ source.hq_location }}</span>
                </div>
                {% endif %}

                <div class="info-item">
                    <span class="info-label">اللغة</span>
                    <span class="info-value">{{ 'عربي' if source.language == 'ar' else source.language }}</span>
                </div>

                {% if source.target_audience %}
                <div class="info-item">
                    <span class="info-label">الجمهور المستهدف</span>
                    <span class="info-value">{{ source.target_audience }}</span>
                </div>
                {% endif %}
            </div>

            <!-- Ownership & Funding Card -->
            <div class="info-card">
                <div class="card-header">
                    <div class="card-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white;">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <h3 class="card-title">الملكية والتمويل</h3>
                </div>

                {% if source.ownership_structure %}
                <div class="info-item">
                    <span class="info-label">هيكل الملكية</span>
                    <span class="info-value">{{ source.ownership_structure }}</span>
                </div>
                {% elif source.owner %}
                <div class="info-item">
                    <span class="info-label">المالك</span>
                    <span class="info-value">{{ source.owner }}</span>
                </div>
                {% endif %}

                {% if source.funding_model %}
                <div class="info-item">
                    <span class="info-label">نموذج التمويل</span>
                    <span class="info-value">{{ source.funding_model }}</span>
                </div>
                {% endif %}

                {% if source.credibility_rating %}
                <div class="info-item">
                    <span class="info-label">تقييم المصداقية</span>
                    <span class="info-value">
                        <span class="status-badge badge-{{ 'high' if 'High' in source.credibility_rating else 'medium' if 'Medium' in source.credibility_rating else 'low' }}">
                            {{ source.credibility_rating }}
                        </span>
                    </span>
                </div>
                {% endif %}

                {% if source.verification_status %}
                <div class="info-item">
                    <span class="info-label">حالة التحقق</span>
                    <span class="info-value">
                        <span class="status-badge badge-high">
                            {{ source.verification_status }}
                        </span>
                    </span>
                </div>
                {% endif %}
            </div>

            <!-- Editorial Stance Card -->
            <div class="info-card">
                <div class="card-header">
                    <div class="card-icon" style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white;">
                        <i class="fas fa-newspaper"></i>
                    </div>
                    <h3 class="card-title">الموقف التحريري</h3>
                </div>

                {% if source.political_alignment %}
                <div class="info-item">
                    <span class="info-label">الانحياز السياسي</span>
                    <span class="info-value">{{ source.political_alignment }}</span>
                </div>
                {% endif %}

                {% if source.bias %}
                <div class="info-item">
                    <span class="info-label">تصنيف الانحياز</span>
                    <span class="info-value">
                        <span class="bias-badge bias-{{ 'oppose' if source.bias == 'Oppose-SAF' else 'neutral' if source.bias == 'Neutral' else 'pro' if source.bias == 'Pro-SAF' else 'unknown' }}">
                            {{ source.bias | bias_arabic }}
                        </span>
                    </span>
                </div>
                {% endif %}

                <div class="info-item">
                    <span class="info-label">عدد المقالات</span>
                    <span class="info-value">{{ source.total_articles or 0 }}</span>
                </div>

                {% if source.has_detailed_metadata %}
                <div class="info-item">
                    <span class="info-label">حالة البيانات</span>
                    <span class="info-value">
                        <span class="status-badge badge-high">
                            <i class="fas fa-check-circle"></i>
                            معلومات شاملة
                        </span>
                    </span>
                </div>
                {% else %}
                <div class="info-item">
                    <span class="info-label">حالة البيانات</span>
                    <span class="info-value">
                        <span class="status-badge badge-medium">
                            <i class="fas fa-info-circle"></i>
                            معلومات أساسية
                        </span>
                    </span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Recent Articles Section -->
        {% if source.recent_articles %}
        <div class="recent-articles">
            <div class="articles-header">
                <h3 class="articles-title">أحدث المقالات</h3>
                <span class="articles-count">{{ source.recent_articles|length }} مقالة</span>
            </div>

            {% for article in source.recent_articles %}
            <div class="article-item">
                <h4 class="article-title">{{ article.headline }}</h4>
                <div class="article-meta">
                    <span><i class="fas fa-calendar-alt"></i> {{ article.published_at | datetime_arabic }}</span>
                    <span><i class="fas fa-tag"></i> {{ 'محلي' if article.category == 'local' else 'دولي' }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Collapsible Methodology Section -->
        <div class="methodology-section">
            <div class="methodology-header" onclick="toggleMethodology()">
                <h3 class="methodology-title">
                    <i class="fas fa-balance-scale"></i>
                    منهجية تصنيف الانحياز
                </h3>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </div>

            <div class="methodology-content" id="methodology-content">
                <div class="methodology-intro">
                    قمنا بحساب الانحياز من خلال تحليل مختلف المقالات من هذه المنافذ الإخبارية. في البداية، كنا نفكر في تصنيف
                    Pro-SAF و Pro-RSF، لكن بسبب الانتهاكات الأخيرة لقوات الدعم السريع (RSF)، لم تعد أي منافذ إخبارية تنحاز
                    إليهم. بدلاً من ذلك، نصنف الأخبار على النحو التالي:
                </div>

                <div class="bias-categories">
                    <div class="bias-category">
                        <div class="bias-category-header pro">
                            <i class="fas fa-thumbs-up"></i>
                            <span>مؤيد - القوات المسلحة (Pro-SAF)</span>
                        </div>
                        <p class="bias-description">
                            المنفذ الإخباري يدعم أو يضفي الشرعية على القوات المسلحة السودانية ويعترف بها كسلطة حاكمة شرعية في
                            السودان. تقاريره أو لهجته التحريرية تصور القوات المسلحة باستمرار كحامية شرعية للدولة والشعب
                            السوداني.
                        </p>
                    </div>

                    <div class="bias-category">
                        <div class="bias-category-header oppose">
                            <i class="fas fa-thumbs-down"></i>
                            <span>معارض - القوات المسلحة (Oppose-SAF)</span>
                        </div>
                        <p class="bias-description">
                            المنفذ الإخباري لا يعترف بالقوات المسلحة السودانية كسلطة حاكمة شرعية، أو يتبنى بانتظام لهجة معادية
                            أو انتقادية أو منتقصة من شرعية قيادة القوات المسلحة وسلوكها أو مطالباتها بسلطة الدولة. غالباً ما
                            يؤطر القوات المسلحة وقوات الدعم السريع على أنهما متساويان أخلاقياً أو ينظر إلى القوات المسلحة كجزء
                            من مشكلة السودان العسكرية-السياسية.
                        </p>
                    </div>

                    <div class="bias-category">
                        <div class="bias-category-header neutral">
                            <i class="fas fa-balance-scale"></i>
                            <span>محايد (Neutral)</span>
                        </div>
                        <p class="bias-description">
                            المنفذ الإخباري لا يظهر انحيازاً واضحاً مع أو ضد القوات المسلحة. التقارير تعتمد على تغطية واقعية أو
                            متوازنة دون إشارات تحريرية متسقة تدعم أو تقوض شرعية القوات المسلحة.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        {% else %}
        <div class="no-data">
            <i class="fas fa-exclamation-triangle"></i>
            <h2>المصدر غير موجود</h2>
            <p>لم نتمكن من العثور على المصدر المطلوب</p>
        </div>
        {% endif %}
    </div>

    <script>
        function toggleMethodology() {
            const content = document.getElementById('methodology-content');
            const toggleIcon = document.querySelector('.toggle-icon');

            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                toggleIcon.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('expanded');
                toggleIcon.style.transform = 'rotate(180deg)';
            }
        }

        // Initialize methodology section as collapsed
        document.addEventListener('DOMContentLoaded', function() {
            const content = document.getElementById('methodology-content');
            const toggleIcon = document.querySelector('.toggle-icon');

            // Start collapsed
            content.classList.remove('expanded');
            toggleIcon.style.transform = 'rotate(0deg)';
        });
    </script>
</body>

</html>
